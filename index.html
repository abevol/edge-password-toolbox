<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Convert and compare password files between Microsoft Edge and Bitwarden | Âú® Microsoft Edge Âíå Bitwarden ‰πãÈó¥ËΩ¨Êç¢ÂíåÂØπÊØîÂØÜÁ†ÅÊñá‰ª∂">
    <meta name="keywords" content="Edge, Bitwarden, password manager, password conversion, password comparison, ÂØÜÁ†ÅÁÆ°ÁêÜÂô®, ÂØÜÁ†ÅËΩ¨Êç¢, ÂØÜÁ†ÅÂØπÊØî">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Edge Password Toolbox | Edge ÂØÜÁ†ÅÂ∑•ÂÖ∑ÁÆ±">
    <meta property="og:description" content="Convert and compare password files between Microsoft Edge and Bitwarden | Âú® Microsoft Edge Âíå Bitwarden ‰πãÈó¥ËΩ¨Êç¢ÂíåÂØπÊØîÂØÜÁ†ÅÊñá‰ª∂">
    <meta property="og:type" content="website">
    <title data-i18n="title">Edge Password Toolbox | Edge ÂØÜÁ†ÅÂ∑•ÂÖ∑ÁÆ±</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
        }
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input[type="file"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        #result, #compareResult {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: none;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-bottom: -1px;
            background-color: transparent;
            color: #666;
        }
        .tab.active {
            border-color: #ddd;
            border-bottom-color: white;
            background-color: white;
            color: #333;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ffeeba;
            border-radius: 4px;
        }
        .warning-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .tab-description {
            background-color: #f8f9fa;
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
            color: #666;
            line-height: 1.5;
        }
        .security-notice {
            color: #2e7d32;
            padding: 12px;
            margin: 10px 0 20px;
            border-radius: 4px;
            background-color: #e8f5e9;
            text-align: center;
            font-weight: 500;
        }
        .security-notice::before {
            content: 'üõ°Ô∏è';
            margin-right: 8px;
        }
        .file-label {
            color: #333;
            margin-top: 15px;
            display: block;
        }
        .language-selector {
            display: inline-flex;
            background-color: #e9ecef;
            border-radius: 4px;
            padding: 2px;
        }
        .language-selector input[type="radio"] {
            display: none;
        }
        .language-selector label {
            padding: 6px 16px;
            color: #666;
            cursor: pointer;
            border-radius: 3px;
            transition: all 0.2s ease;
            margin: 0;
            display: block;
        }
        .language-selector label:hover {
            color: #333;
        }
        .language-selector input[type="radio"]:checked + label {
            background: white;
            color: #333;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-selector">
            <input type="radio" name="language" id="lang-zh" value="zh" checked onchange="switchLanguage('zh')">
            <label for="lang-zh">‰∏≠Êñá</label>
            <input type="radio" name="language" id="lang-en" value="en" onchange="switchLanguage('en')">
            <label for="lang-en">English</label>
        </div>
        <h1 data-i18n="title"></h1>
        <div class="security-notice" data-i18n="security_notice"></div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('convert')" data-i18n="tabs.convert"></div>
            <div class="tab" onclick="switchTab('compare')" data-i18n="tabs.compare"></div>
        </div>

        <div id="convertTab" class="tab-content active">
            <div class="tab-description" data-i18n="convert.description"></div>
            <div class="form-group">
                <label for="sourceFormat" data-i18n="convert.sourceFormat"></label>
                <select id="sourceFormat">
                    <option value="bitwarden">Bitwarden</option>
                    <option value="edge">Microsoft Edge</option>
                </select>
            </div>
            <div class="form-group">
                <label for="csvFile" data-i18n="convert.selectFile"></label>
                <input type="file" id="csvFile" accept=".csv">
            </div>
            <button onclick="convertFile()" data-i18n="convert.convert"></button>
            <div id="result"></div>
        </div>

        <div id="compareTab" class="tab-content">
            <div class="tab-description" data-i18n="compare.description"></div>
            <div class="form-group">
                <label class="file-label" data-i18n="compare.file1"></label>
                <select id="format1">
                    <option value="bitwarden" selected>Bitwarden</option>
                    <option value="edge">Microsoft Edge</option>
                </select>
                <input type="file" id="csvFile1" accept=".csv">
            </div>
            <div class="form-group">
                <label class="file-label" data-i18n="compare.file2"></label>
                <select id="format2">
                    <option value="bitwarden">Bitwarden</option>
                    <option value="edge" selected>Microsoft Edge</option>
                </select>
                <input type="file" id="csvFile2" accept=".csv">
            </div>
            <button onclick="compareFiles()" data-i18n="compare.compare"></button>
            <div id="compareResult"></div>
        </div>
    </div>

    <script>
        // ÈõÜ‰∏≠ÁÆ°ÁêÜÊâÄÊúâÁøªËØëÊñáÊú¨
        const i18n = {
            zh: {
                title: 'Edge ÂØÜÁ†ÅÂ∑•ÂÖ∑ÁÆ±',
                tabs: {
                    convert: 'Ê†ºÂºèËΩ¨Êç¢',
                    compare: 'ÂØÜÁ†ÅÂØπÊØî'
                },
                security_notice: 'Á∫ØÂâçÁ´ØÂÆûÁé∞ÔºåÊâÄÊúâÊï∞ÊçÆÂ§ÑÁêÜÂú®Êú¨Âú∞ÂÆåÊàêÔºåÊó†ÈúÄ‰∏ä‰º†Âà∞ÊúçÂä°Âô®ÔºåÂÆâÂÖ®ÂèØÈù†„ÄÇ',
                convert: {
                    description: 'Â∞Ü CSV ÂØÜÁ†ÅÊñá‰ª∂Âú®‰∏çÂêåÂπ≥Âè∞Ê†ºÂºè‰πãÈó¥ËøõË°åËΩ¨Êç¢„ÄÇÁõÆÂâçÊîØÊåÅÂú® Bitwarden Âíå Microsoft Edge ‰πãÈó¥‰∫íÁõ∏ËΩ¨Êç¢„ÄÇ',
                    sourceFormat: 'Ê∫êÊñá‰ª∂Âπ≥Âè∞Ê†ºÂºèÔºö',
                    selectFile: 'ÈÄâÊã©ÂØÜÁ†ÅÊñá‰ª∂Ôºö',
                    convert: 'ËΩ¨Êç¢'
                },
                compare: {
                    description: 'ÂØπÊØî‰∏§‰∏™‰∏çÂêåÁöÑ CSV ÂØÜÁ†ÅÊñá‰ª∂ÔºåÊâæÂá∫ÂØÜÁ†Å‰∏ç‰∏ÄËá¥ÁöÑËÆ∞ÂΩï„ÄÇÂèØ‰ª•ÂØπÊØî‰∏çÂêåÂπ≥Âè∞Ê†ºÂºèÁöÑÂØÜÁ†ÅÊñá‰ª∂ÔºåÊñπ‰æøÊ£ÄÊü•ÂØÜÁ†ÅÊòØÂê¶ÂèØ‰ª•Ë¢´ÂØºÂÖ•Âà∞Âè¶‰∏Ä‰∏™Âπ≥Âè∞ËÄå‰∏çÂºïËµ∑ÂÜ≤Á™Å„ÄÇ',
                    file1: 'Êñá‰ª∂ 1Ôºö',
                    file2: 'Êñá‰ª∂ 2Ôºö',
                    compare: 'ÂØπÊØî',
                    noMismatch: 'Ê≤°ÊúâÂèëÁé∞ÂØÜÁ†Å‰∏çÂåπÈÖçÁöÑËÆ∞ÂΩï„ÄÇ',
                    foundMismatch: 'ÂèëÁé∞‰ª•‰∏ãÂØÜÁ†Å‰∏çÂåπÈÖçÔºö',
                    username: 'Áî®Êà∑Âêç',
                    record: 'ËÆ∞ÂΩï',
                    name: 'ÂêçÁß∞',
                    password: 'ÂØÜÁ†Å'
                },
                messages: {
                    selectFile: 'ËØ∑ÈÄâÊã©‰∏Ä‰∏™CSVÊñá‰ª∂',
                    selectFiles: 'ËØ∑ÈÄâÊã©‰∏§‰∏™Ë¶ÅÂØπÊØîÁöÑÊñá‰ª∂',
                    compareError: 'ÂØπÊØîÊñá‰ª∂Êó∂Âá∫Èîô: '
                }
            },
            en: {
                title: 'Edge Password Toolbox',
                security_notice: 'Pure frontend implementation, all data processing is done locally, no server upload required, secure and reliable.',
                tabs: {
                    convert: 'Format Conversion',
                    compare: 'Password Comparison'
                },
                convert: {
                    description: 'Convert CSV password files between different platforms. Currently supports conversion between Bitwarden and Microsoft Edge.',
                    sourceFormat: 'Source Platform Format:',
                    selectFile: 'Select Password File:',
                    convert: 'Convert'
                },
                compare: {
                    description: 'Compare two different CSV password files to find records with inconsistent passwords. You can compare files in different platforms to check if passwords can be imported into another platform without conflicts.',
                    file1: 'File 1:',
                    file2: 'File 2:',
                    compare: 'Compare',
                    noMismatch: 'No password mismatches found.',
                    foundMismatch: 'Found the following password mismatches:',
                    username: 'Username',
                    record: 'Record',
                    name: 'Name',
                    password: 'Password'
                },
                messages: {
                    selectFile: 'Please select a CSV file',
                    selectFiles: 'Please select two files to compare',
                    compareError: 'Error comparing files: '
                }
            }
        };

        // Ëé∑ÂèñÁøªËØëÊñáÊú¨ÁöÑËæÖÂä©ÂáΩÊï∞
        function t(key, params = {}) {
            const keys = key.split('.');
            let value = i18n[currentLanguage];
            
            for (const k of keys) {
                value = value[k];
                if (value === undefined) {
                    console.warn(`Translation key not found: ${key}`);
                    return key;
                }
            }

            // ÊîØÊåÅÊ®°ÊùøÂ≠óÁ¨¶‰∏≤ÊõøÊç¢
            return value.replace(/\${(\w+)}/g, (_, param) => params[param] || '');
        }

        // ‰ªé localStorage Ëé∑Âèñ‰øùÂ≠òÁöÑËØ≠Ë®ÄËÆæÁΩÆ
        let currentLanguage = localStorage.getItem('language') || 'zh';

        function switchLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', currentLanguage);
            document.documentElement.lang = currentLanguage === 'zh' ? 'zh-CN' : 'en';
            
            // Êõ¥Êñ∞ÂçïÈÄâÊ°ÜÁä∂ÊÄÅ
            document.querySelectorAll('input[name="language"]').forEach(radio => {
                radio.checked = radio.value === currentLanguage;
            });
            
            updateLanguage();
        }

        function updateLanguage() {
            // Êõ¥Êñ∞ÊâÄÊúâÂ∏¶Êúâ data-i18n Â±ûÊÄßÁöÑÂÖÉÁ¥†
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (element.tagName.toLowerCase() === 'title') {
                    // ÂØπ‰∫é title Ê†áÁ≠æÔºåÂêåÊó∂Êõ¥Êñ∞ document.title
                    const text = t(key);
                    element.textContent = text;
                    document.title = text;
                } else {
                    element.textContent = t(key);
                }
            });
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñËØ≠Ë®Ä
        document.addEventListener('DOMContentLoaded', () => {
            // Ê†πÊçÆ‰øùÂ≠òÁöÑËØ≠Ë®ÄËÆæÁΩÆÂàùÂßãÂåñÂçïÈÄâÊ°Ü
            document.querySelectorAll('input[name="language"]').forEach(radio => {
                radio.checked = radio.value === currentLanguage;
            });
            updateLanguage();
        });

        function switchTab(tabName) {
            // Êõ¥Êñ∞Ê†áÁ≠æÁä∂ÊÄÅ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ÊøÄÊ¥ªÈÄâ‰∏≠ÁöÑÊ†áÁ≠æ
            const selectedTab = document.querySelector(`.tab:nth-child(${tabName === 'convert' ? '1' : '2'})`);
            const selectedContent = document.getElementById(`${tabName}Tab`);
            selectedTab.classList.add('active');
            selectedContent.classList.add('active');
        }

        async function compareFiles() {
            const file1 = document.getElementById('csvFile1').files[0];
            const file2 = document.getElementById('csvFile2').files[0];
            const format1 = document.getElementById('format1').value;
            const format2 = document.getElementById('format2').value;

            if (!file1 || !file2) {
                alert(t('messages.selectFiles'));
                return;
            }

            try {
                const content1 = await readFileContent(file1);
                const content2 = await readFileContent(file2);

                const data1 = normalizePasswordData(content1, format1);
                const data2 = normalizePasswordData(content2, format2);

                const differences = findDifferences(data1, data2);
                displayDifferences(differences, file1.name, file2.name);
            } catch (error) {
                console.error(t('messages.compareError'), error);
                alert(t('messages.compareError') + error.message);
            }
        }

        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(new Error('ËØªÂèñÊñá‰ª∂Â§±Ë¥•'));
                reader.readAsText(file);
            });
        }

        function normalizePasswordData(csvContent, format) {
            const lines = parseCSV(csvContent);
            const data = lines.slice(1); // Ë∑≥ËøáÊ†áÈ¢òË°å
            const result = [];

            data.forEach(row => {
                if (format === 'bitwarden') {
                    if (row.length >= 10) {
                        result.push({
                            url: row[7] || '',
                            username: row[8] || '',
                            password: row[9] || '',
                            name: row[3] || ''
                        });
                    }
                } else { // edge
                    if (row.length >= 4) {
                        result.push({
                            url: row[1] || '',
                            username: row[2] || '',
                            password: row[3] || '',
                            name: row[0] || ''
                        });
                    }
                }
            });

            return result;
        }

        function findDifferences(data1, data2) {
            const differences = [];
            
            // ÂàõÂª∫Êü•ÊâæÁ¥¢Âºï
            const index2 = new Map();
            data2.forEach(item => {
                const key = `${item.url}|${item.username}`;
                index2.set(key, item);
            });

            // Ê£ÄÊü•Á¨¨‰∏Ä‰∏™Êï∞ÊçÆÈõÜ‰∏≠ÁöÑÊØè‰∏™Êù°ÁõÆ
            data1.forEach(item1 => {
                const key = `${item1.url}|${item1.username}`;
                const item2 = index2.get(key);

                if (item2) {
                    // URLÂíåÁî®Êà∑ÂêçÂåπÈÖçÔºå‰ΩÜÂØÜÁ†Å‰∏çÂêå
                    if (item1.password !== item2.password) {
                        differences.push({
                            type: 'password_mismatch',
                            url: item1.url,
                            username: item1.username,
                            name1: item1.name,
                            name2: item2.name,
                            password1: item1.password,
                            password2: item2.password
                        });
                    }
                }
            });

            return differences;
        }

        function displayDifferences(differences, fileName1, fileName2) {
            const resultDiv = document.getElementById('compareResult');
            resultDiv.style.display = 'block';
            
            const messages = {
                zh: {
                    noMismatch: 'Ê≤°ÊúâÂèëÁé∞ÂØÜÁ†Å‰∏çÂåπÈÖçÁöÑËÆ∞ÂΩï„ÄÇ',
                    foundMismatch: 'ÂèëÁé∞‰ª•‰∏ãÂØÜÁ†Å‰∏çÂåπÈÖçÔºö',
                    username: 'Áî®Êà∑Âêç',
                    record: 'ËÆ∞ÂΩï',
                    name: 'ÂêçÁß∞',
                    password: 'ÂØÜÁ†Å'
                },
                en: {
                    noMismatch: 'No password mismatches found.',
                    foundMismatch: 'Found the following password mismatches:',
                    username: 'Username',
                    record: 'Record',
                    name: 'Name',
                    password: 'Password'
                }
            };

            if (differences.length === 0) {
                resultDiv.innerHTML = `<div class="warning">${t('compare.noMismatch')}</div>`;
                return;
            }

            let html = `<h3>${t('compare.foundMismatch')}</h3>`;
            differences.forEach(diff => {
                if (diff.type === 'password_mismatch') {
                    html += `
                        <div class="warning">
                            <div class="warning-title">URL: ${diff.url}</div>
                            <div>${t('compare.username')}: ${diff.username}</div>
                            <div>${t('compare.record')}1 (${fileName1}): ${diff.name1 ? `${t('compare.name')}: ${diff.name1}, ` : ''}${t('compare.password')}: ${diff.password1}</div>
                            <div>${t('compare.record')}2 (${fileName2}): ${diff.name2 ? `${t('compare.name')}: ${diff.name2}, ` : ''}${t('compare.password')}: ${diff.password2}</div>
                        </div>
                    `;
                }
            });
            
            resultDiv.innerHTML = html;
        }

        function convertFile() {
            const fileInput = document.getElementById('csvFile');
            const sourceFormat = document.getElementById('sourceFormat').value;
            const file = fileInput.files[0];

            if (!file) {
                alert(t('messages.selectFile'));
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const converted = convertFormat(text, sourceFormat);
                downloadCSV(converted, `converted_${sourceFormat === 'bitwarden' ? 'edge' : 'bitwarden'}_${file.name}`);
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const result = [];
            let row = [];
            let inQuotes = false;
            let currentValue = '';
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const nextChar = text[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // Â§ÑÁêÜËΩ¨‰πâÁöÑÂèåÂºïÂè∑
                        currentValue += '"';
                        i++; // Ë∑≥Ëøá‰∏ã‰∏Ä‰∏™ÂºïÂè∑
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    row.push(currentValue);
                    currentValue = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    if (currentValue || row.length > 0) {
                        row.push(currentValue);
                        result.push(row);
                        row = [];
                        currentValue = '';
                    }
                    // Ë∑≥Ëøá \r\n ‰∏≠ÁöÑ \n
                    if (char === '\r' && nextChar === '\n') {
                        i++;
                    }
                } else {
                    currentValue += char;
                }
            }
            
            // Â§ÑÁêÜÊúÄÂêé‰∏Ä‰∏™ÂÄºÂíåË°å
            if (currentValue || row.length > 0) {
                row.push(currentValue);
                result.push(row);
            }
            
            return result;
        }

        function escapeCSVField(field) {
            if (field.includes('"') || field.includes(',') || field.includes('\n') || field.includes('\r')) {
                // Â∞ÜÂ≠óÊÆµ‰∏≠ÁöÑÂèåÂºïÂè∑ÊõøÊç¢‰∏∫‰∏§‰∏™ÂèåÂºïÂè∑ÔºåÂπ∂Áî®ÂèåÂºïÂè∑ÂåÖË£πÊï¥‰∏™Â≠óÊÆµ
                return '"' + field.replace(/"/g, '""') + '"';
            }
            return field;
        }

        function convertFormat(csvText, sourceFormat) {
            // Ëß£ÊûêCSV
            const lines = parseCSV(csvText);
            const headers = lines[0];
            const data = lines.slice(1);

            let result = [];

            if (sourceFormat === 'bitwarden') {
                // Bitwarden ËΩ¨ Edge
                result.push(['name', 'url', 'username', 'password', 'note'].map(escapeCSVField).join(','));
                
                data.forEach(row => {
                    if (row.length < 10) return; // Ë∑≥ËøáÊó†ÊïàË°å
                    const name = row[3] || '';
                    const url = row[7] || '';
                    const username = row[8] || '';
                    const password = row[9] || '';
                    const notes = row[4] || '';
                    result.push([name, url, username, password, notes].map(escapeCSVField).join(','));
                });
            } else {
                // Edge ËΩ¨ Bitwarden
                result.push(['folder', 'favorite', 'type', 'name', 'notes', 'fields', 'reprompt', 'login_uri', 'login_username', 'login_password', 'login_totp'].map(escapeCSVField).join(','));
                
                data.forEach(row => {
                    if (row.length < 4) return; // Ë∑≥ËøáÊó†ÊïàË°å
                    const newRow = [
                        '', // folder
                        '', // favorite
                        'login', // type
                        row[0] || '', // name
                        row[4] || '', // notes
                        '', // fields
                        '0', // reprompt
                        row[1] || '', // login_uri
                        row[2] || '', // login_username
                        row[3] || '', // login_password
                        '' // login_totp
                    ];
                    result.push(newRow.map(escapeCSVField).join(','));
                });
            }

            return result.join('\n');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (navigator.msSaveBlob) {
                navigator.msSaveBlob(blob, filename);
                return;
            }
            link.href = window.URL.createObjectURL(blob);
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>